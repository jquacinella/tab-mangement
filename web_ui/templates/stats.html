{% extends "base.html" %}

{% block title %}TabBacklog - Statistics{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Statistics</h1>

    <!-- Summary Cards -->
    <section class="stats-cards">
        <div class="stat-card">
            <div class="stat-value">{{ filter_options.total }}</div>
            <div class="stat-label">Total Tabs</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ filter_options.processed }}</div>
            <div class="stat-label">Processed</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ filter_options.unprocessed }}</div>
            <div class="stat-label">Remaining</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ ((filter_options.processed / filter_options.total) * 100)|round|int if filter_options.total else 0 }}%</div>
            <div class="stat-label">Progress</div>
        </div>
    </section>

    <div class="stats-grid">
        <!-- Status Breakdown -->
        <section class="stats-section">
            <h2>By Status</h2>
            <div class="stats-list">
                {% for item in status_counts %}
                <div class="stats-row">
                    <span class="stats-label">
                        <span class="badge badge-{{ item.status.replace('_', '-') }}">{{ item.status }}</span>
                    </span>
                    <span class="stats-count">{{ item.count }}</span>
                    <div class="stats-bar">
                        <div class="stats-bar-fill" style="width: {{ (item.count / filter_options.total * 100)|round }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Content Type Breakdown -->
        <section class="stats-section">
            <h2>By Content Type</h2>
            <div class="stats-list">
                {% for item in content_type_counts %}
                <div class="stats-row">
                    <span class="stats-label">
                        <span class="badge type-{{ item.content_type }}">{{ item.content_type }}</span>
                    </span>
                    <span class="stats-count">{{ item.count }}</span>
                    <div class="stats-bar">
                        <div class="stats-bar-fill" style="width: {{ (item.count / filter_options.total * 100)|round }}%"></div>
                    </div>
                </div>
                {% else %}
                <p class="empty-hint">No enriched tabs yet</p>
                {% endfor %}
            </div>
        </section>
    </div>

    <!-- Recent Activity -->
    <section class="stats-section">
        <h2>Recent Activity</h2>
        <table class="activity-table">
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Entity</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for event in recent_events %}
                <tr>
                    <td>{{ event.event_type }}</td>
                    <td>{{ event.entity_type or '-' }}</td>
                    <td>{{ event.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" class="empty-cell">No recent activity</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</div>

<style>
.page-title {
    margin-bottom: 1.5rem;
}

.stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: 1.5rem;
    text-align: center;
    box-shadow: var(--shadow-sm);
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-primary);
}

.stat-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-top: 0.25rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stats-section {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
}

.stats-section h2 {
    font-size: 1rem;
    margin: 0 0 1rem;
    color: var(--color-text-muted);
}

.stats-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.stats-row {
    display: grid;
    grid-template-columns: 120px 50px 1fr;
    align-items: center;
    gap: 0.75rem;
}

.stats-count {
    font-weight: 600;
    text-align: right;
}

.stats-bar {
    height: 8px;
    background: var(--color-bg);
    border-radius: 4px;
    overflow: hidden;
}

.stats-bar-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: 4px;
    transition: width 0.3s ease;
}

.activity-table {
    width: 100%;
    border-collapse: collapse;
}

.activity-table th,
.activity-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
}

.activity-table th {
    font-size: 0.75rem;
    text-transform: uppercase;
    color: var(--color-text-muted);
}
</style>
{% endblock %}
